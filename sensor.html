<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tent Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* Header */
        .header {
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tent-selector {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Navigation */
        .nav-tabs {
            background: white;
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-tab {
            background: #e0e0e0;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab.active {
            background: #4CAF50;
            color: white;
        }

        /* Main Content */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Section */
        .section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        /* Sensor Grid */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .sensor-card {
            background: #f8f8f8;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border-top: 4px solid #4CAF50;
        }

        .sensor-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .sensor-value {
            font-size: 28px;
            font-weight: 700;
            color: #4CAF50;
            margin: 10px 0;
        }

        .sensor-label {
            font-size: 14px;
            color: #666;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        /* Camera Section */
        .camera-container {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
            margin-bottom: 15px;
        }

        .camera-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-status {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #f44336;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .camera-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        /* Alert */
        .alert {
            background: #FFEBEE;
            border-left: 4px solid #F44336;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
        }

        .alert.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="disconnect-btn">
                <span>d√©connection üèïÔ∏è</span>
            </div>
            <button class="tent-selector">üèïÔ∏è tente principale ‚ñº</button>
        </div>
        <div class="header-right">
            <span>üåê En ligne</span>
            <span>üìä <span id="dataUsage">0.00</span> MB</span>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <a href="index.html" class="nav-tab active">
            <span>üè†</span>
            <span>Tableau de bord</span>
        </a>
        <a href="history.html" class="nav-tab">
            <span>üìà</span>
            <span>Historique</span>
        </a>
        <a href="map.html" class="nav-tab">
            <span>üó∫Ô∏è</span>
            <span>Carte</span>
        </a>
        <a href="settings.html" class="nav-tab">
            <span>‚öôÔ∏è</span>
            <span>Param√®tres</span>
        </a>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Alert -->
        <div class="alert" id="gasAlert">
            <strong>‚ö†Ô∏è ALERTE GAZ!</strong> Niveau dangereux d√©tect√© (>200 ppm). Ventilez imm√©diatement!
        </div>

        <!-- Conditions Int√©rieures -->
        <div class="section">
            <div class="section-header">
                <span>üè†</span>
                <span>Conditions Int√©rieures</span>
            </div>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">üå°Ô∏è</div>
                    <div class="sensor-value" id="tempInt">25.3¬∞C</div>
                    <div class="sensor-label">Temp√©rature</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üíß</div>
                    <div class="sensor-value" id="humInt">62%</div>
                    <div class="sensor-label">Humidit√©</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üí®</div>
                    <div class="sensor-value" id="gas">45 ppm</div>
                    <div class="sensor-label">Gaz (MQ-5)</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üëÅÔ∏è</div>
                    <div class="sensor-value" id="movementInt">Aucun</div>
                    <div class="sensor-label">Mouvement</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary">üå°Ô∏è Mode Confort</button>
                <button class="btn btn-secondary" onclick="refreshData()">üîÑ Actualiser</button>
            </div>
        </div>

        <!-- Conditions Ext√©rieures -->
        <div class="section">
            <div class="section-header">
                <span>üåç</span>
                <span>Conditions Ext√©rieures</span>
            </div>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">üå°Ô∏è</div>
                    <div class="sensor-value" id="tempExt">34¬∞C</div>
                    <div class="sensor-label">Temp√©rature</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üíß</div>
                    <div class="sensor-value" id="humExt">20%</div>
                    <div class="sensor-label">Humidit√©</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üå¨Ô∏è</div>
                    <div class="sensor-value" id="wind">0 km/h</div>
                    <div class="sensor-label">Vent</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üö∂</div>
                    <div class="sensor-value" id="movementExt">Aucun</div>
                    <div class="sensor-label">Mouvement</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary">üå§Ô∏è M√©t√©o</button>
                <button class="btn btn-secondary" onclick="refreshData()">üîÑ Actualiser</button>
            </div>
        </div>

        <!-- Syst√®me -->
        <div class="section">
            <div class="section-header">
                <span>üîß</span>
                <span>Syst√®me</span>
            </div>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">üì°</div>
                    <div class="sensor-value" id="signal">87%</div>
                    <div class="sensor-label">Signal 4G</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üîã</div>
                    <div class="sensor-value" id="battery">94%</div>
                    <div class="sensor-label">Batterie</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üíª</div>
                    <div class="sensor-value" id="cpuTemp">52¬∞C</div>
                    <div class="sensor-label">CPU Temp</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary">üîç Diagnostic</button>
                <button class="btn btn-secondary">‚ö° Optimiser</button>
            </div>
        </div>

        <!-- Surveillance -->
        <div class="section">
            <div class="section-header">
                <span>üìπ</span>
                <span>Surveillance ESP32-CAM</span>
            </div>
            
            <div class="camera-container">
                <!-- METTEZ VOTRE VIDEO ICI -->
                <video autoplay loop muted playsinline>
                    <source src="camera_demo.mp4" type="video/mp4">
                </video>
                <div class="camera-status">üî¥ EN DIRECT</div>
            </div>
            
            <div class="camera-controls">
                <button class="btn btn-primary" onclick="capturePhoto()">üì∏ Photo</button>
                <button class="btn btn-secondary">üëÅÔ∏è D√©tection</button>
                <button class="btn btn-secondary">üé• Enregistrer</button>
                <button class="btn btn-secondary">üîç Plein √©cran</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // Configuration Firebase - REMPLACEZ PAR VOS CL√âS
        const firebaseConfig = {
            apiKey: "IzaSyCiXvPYhgNQlrPJfA067hM-7eL5L88QlCE",
            authDomain: "smart-tent-iot.firebaseapp.com",
            databaseURL: "https://smart-tent-iot-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "smart-tent-iot",
            storageBucket: "smart-tent-iot.firebasestorage.ap",
            messagingSenderId: "Y99002146412",
            appId: "1:99002146412:web:a5123156ac49de6db74249"
        };

        let database;
        let dataUsage = 0;

        // Initialiser Firebase
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                console.log('‚úÖ Firebase connect√©');
                
                // √âcouter les donn√©es
                const sensorRef = database.ref('sensors/tent_01');
                sensorRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        console.log('üìä Donn√©es re√ßues:', data);
                        updateDashboard(data);
                        
                        // Incr√©menter l'usage
                        dataUsage += 0.01;
                        document.getElementById('dataUsage').textContent = dataUsage.toFixed(2);
                    }
                });
            } catch (error) {
                console.error('‚ùå Erreur Firebase:', error);
                // Continuer en mode d√©mo
                startDemoMode();
            }
        }

        // Mettre √† jour le dashboard avec les vraies donn√©es
        function updateDashboard(data) {
            // Int√©rieur
            document.getElementById('tempInt').textContent = (data.temperature_interior ? data.temperature_interior.toFixed(1) : '25.3') + '¬∞C';
            document.getElementById('humInt').textContent = (data.humidity_interior || 62) + '%';
            document.getElementById('gas').textContent = (data.gas_ppm || 45) + ' ppm';
            document.getElementById('movementInt').textContent = data.movement || 'Aucun';
            
            // Ext√©rieur
            document.getElementById('tempExt').textContent = (data.temperature_exterior ? data.temperature_exterior.toFixed(1) : '22.8') + '¬∞C';
            document.getElementById('humExt').textContent = (data.humidity_exterior || 75) + '%';
            document.getElementById('wind').textContent = (data.wind_speed || 12) + ' km/h';
            
            // Syst√®me
            document.getElementById('signal').textContent = (data.signal_4g || 87) + '%';
            document.getElementById('battery').textContent = (data.battery || 94) + '%';
            document.getElementById('cpuTemp').textContent = (data.cpu_temp || 52) + '¬∞C';
            
            // Alerte gaz
            if (data.gas_ppm > 200) {
                document.getElementById('gasAlert').classList.add('show');
            } else {
                document.getElementById('gasAlert').classList.remove('show');
            }
            
            // Si mouvement d√©tect√©
            if (data.movement === 'D√©tect√©' || data.motion_detected) {
                document.getElementById('movementInt').textContent = 'D√©tect√©';
                document.getElementById('movementInt').style.color = '#F44336';
                setTimeout(() => {
                    document.getElementById('movementInt').textContent = 'Aucun';
                    document.getElementById('movementInt').style.color = '#4CAF50';
                }, 5000);
            }
        }

        // Mode d√©mo avec valeurs r√©alistes
        function startDemoMode() {
            console.log('üéÆ Mode d√©mo activ√©');
            
            setInterval(() => {
                // Valeurs r√©alistes qui varient l√©g√®rement
                const baseTemp = 25;
                const baseHum = 65;
                const baseGas = 45;
                
                const data = {
                    temperature_interior: baseTemp + (Math.random() - 0.5) * 2,
                    humidity_interior: Math.round(baseHum + (Math.random() - 0.5) * 10),
                    gas_ppm: Math.round(baseGas + (Math.random() - 0.5) * 20),
                    temperature_exterior: baseTemp - 2 + (Math.random() - 0.5) * 2,
                    humidity_exterior: Math.round(baseHum + 10 + (Math.random() - 0.5) * 10),
                    wind_speed: Math.round(10 + Math.random() * 10),
                    signal_4g: Math.round(80 + Math.random() * 15),
                    battery: Math.round(90 + Math.random() * 8),
                    movement: Math.random() > 0.9 ? 'D√©tect√©' : 'Aucun'
                };
                
                updateDashboard(data);
                
                // Simuler l'usage de donn√©es
                dataUsage += 0.01;
                document.getElementById('dataUsage').textContent = dataUsage.toFixed(2);
            }, 3000);
        }

        // Rafra√Æchir les donn√©es
        function refreshData() {
            console.log('üîÑ Actualisation...');
            
            // Animation du bouton
            event.target.style.transform = 'scale(0.95)';
            setTimeout(() => {
                event.target.style.transform = 'scale(1)';
            }, 200);
            
            // Si Firebase connect√©, forcer la lecture
            if (database) {
                database.ref('sensors/tent_01').once('value').then(snapshot => {
                    const data = snapshot.val();
                    if (data) updateDashboard(data);
                });
            }
        }

        // Capture photo
        function capturePhoto() {
            console.log('üì∏ Photo captur√©e');
            
            // Flash effect
            const video = document.querySelector('video');
            video.style.filter = 'brightness(2)';
            setTimeout(() => {
                video.style.filter = 'brightness(1)';
            }, 100);
            
            // Notification
            alert('Photo captur√©e avec succ√®s!');
        }

        // Au chargement
        window.onload = function() {
            console.log('üèïÔ∏è Smart Tent Dashboard v1.0');
            
            // V√©rifier Firebase
            if (firebaseConfig.apiKey !== "YOUR-API-KEY") {
                console.log('üî• Tentative de connexion Firebase...');
                initFirebase();
            } else {
                console.log('‚ö†Ô∏è Firebase non configur√© - Mode d√©mo');
                startDemoMode();
            }
        };
    </script>
</body>
</html>
