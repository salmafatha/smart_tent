<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tent Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* Header */
        .header {
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tent-selector {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Navigation */
        .nav-tabs {
            background: white;
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-tab {
            background: #e0e0e0;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab.active {
            background: #4CAF50;
            color: white;
        }

        /* Main Content */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Section */
        .section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        /* Sensor Grid */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .sensor-card {
            background: #f8f8f8;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border-top: 4px solid #4CAF50;
        }

        .sensor-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .sensor-value {
            font-size: 28px;
            font-weight: 700;
            color: #4CAF50;
            margin: 10px 0;
        }

        .sensor-label {
            font-size: 14px;
            color: #666;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        /* Camera Section */
        .camera-container {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
            margin-bottom: 15px;
        }

        .camera-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-status {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #f44336;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .camera-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        /* Alert */
        .alert {
            background: #FFEBEE;
            border-left: 4px solid #F44336;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
        }

        .alert.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="disconnect-btn">
                <span>dÃ©connection ğŸ•ï¸</span>
            </div>
            <button class="tent-selector">ğŸ•ï¸ tente principale â–¼</button>
        </div>
        <div class="header-right">
            <span>ğŸŒ En ligne</span>
            <span>ğŸ“Š <span id="dataUsage">0.00</span> MB</span>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <a href="index.html" class="nav-tab active">
            <span>ğŸ </span>
            <span>Tableau de bord</span>
        </a>
        <a href="history.html" class="nav-tab">
            <span>ğŸ“ˆ</span>
            <span>Historique</span>
        </a>
        <a href="map.html" class="nav-tab">
            <span>ğŸ—ºï¸</span>
            <span>Carte</span>
        </a>
        <a href="settings.html" class="nav-tab">
            <span>âš™ï¸</span>
            <span>ParamÃ¨tres</span>
        </a>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Alert -->
        <div class="alert" id="gasAlert">
            <strong>âš ï¸ ALERTE GAZ!</strong> Niveau dangereux dÃ©tectÃ© (>200 ppm). Ventilez immÃ©diatement!
        </div>

        <!-- Conditions IntÃ©rieures -->
        <div class="section">
            <div class="section-header">
                <span>ğŸ </span>
                <span>Conditions IntÃ©rieures</span>
            </div>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸŒ¡ï¸</div>
                    <div class="sensor-value" id="tempInt">25.3Â°C</div>
                    <div class="sensor-label">TempÃ©rature</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ’§</div>
                    <div class="sensor-value" id="humInt">62%</div>
                    <div class="sensor-label">HumiditÃ©</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ’¨</div>
                    <div class="sensor-value" id="gas">45 ppm</div>
                    <div class="sensor-label">Gaz (MQ-5)</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ‘ï¸</div>
                    <div class="sensor-value" id="movementInt">Aucun</div>
                    <div class="sensor-label">Mouvement</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary">ğŸŒ¡ï¸ Mode Confort</button>
                <button class="btn btn-secondary" onclick="refreshData()">ğŸ”„ Actualiser</button>
            </div>
        </div>

        <!-- Conditions ExtÃ©rieures -->
        <div class="section">
            <div class="section-header">
                <span>ğŸŒ</span>
                <span>Conditions ExtÃ©rieures</span>
            </div>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸŒ¡ï¸</div>
                    <div class="sensor-value" id="tempExt">34Â°C</div>
                    <div class="sensor-label">TempÃ©rature</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ’§</div>
                    <div class="sensor-value" id="humExt">20%</div>
                    <div class="sensor-label">HumiditÃ©</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸŒ¬ï¸</div>
                    <div class="sensor-value" id="wind">0 km/h</div>
                    <div class="sensor-label">Vent</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸš¶</div>
                    <div class="sensor-value" id="movementExt">Aucun</div>
                    <div class="sensor-label">Mouvement</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary">ğŸŒ¤ï¸ MÃ©tÃ©o</button>
                <button class="btn btn-secondary" onclick="refreshData()">ğŸ”„ Actualiser</button>
            </div>
        </div>

        <!-- SystÃ¨me -->
        <div class="section">
            <div class="section-header">
                <span>ğŸ”§</span>
                <span>SystÃ¨me</span>
            </div>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ“¡</div>
                    <div class="sensor-value" id="signal">87%</div>
                    <div class="sensor-label">Signal 4G</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ”‹</div>
                    <div class="sensor-value" id="battery">94%</div>
                    <div class="sensor-label">Batterie</div>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">ğŸ’»</div>
                    <div class="sensor-value" id="cpuTemp">52Â°C</div>
                    <div class="sensor-label">CPU Temp</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary">ğŸ” Diagnostic</button>
                <button class="btn btn-secondary">âš¡ Optimiser</button>
            </div>
        </div>

        <!-- Surveillance -->
        <div class="section">
            <div class="section-header">
                <span>ğŸ“¹</span>
                <span>Surveillance ESP32-CAM</span>
            </div>
            
            <div class="camera-container">
                <!-- METTEZ VOTRE VIDEO ICI -->
                <video autoplay loop muted playsinline>
                    <source src="camera_demo.mp4" type="video/mp4">
                </video>
                <div class="camera-status">ğŸ”´ EN DIRECT</div>
            </div>
            
            <div class="camera-controls">
                <button class="btn btn-primary" onclick="capturePhoto()">ğŸ“¸ Photo</button>
                <button class="btn btn-secondary">ğŸ‘ï¸ DÃ©tection</button>
                <button class="btn btn-secondary">ğŸ¥ Enregistrer</button>
                <button class="btn btn-secondary">ğŸ” Plein Ã©cran</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // Configuration Firebase - REMPLACEZ PAR VOS CLÃ‰S
        const firebaseConfig = {
            apiKey: "IzaSyCiXvPYhgNQlrPJfA067hM-7eL5L88QlCE",
            authDomain: "smart-tent-iot.firebaseapp.com",
            databaseURL: "https://smart-tent-iot-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "smart-tent-iot",
            storageBucket: "smart-tent-iot.firebasestorage.ap",
            messagingSenderId: "Y99002146412",
            appId: "1:99002146412:web:a5123156ac49de6db74249"
        };

        let database;
        let dataUsage = 0;

        // Initialiser Firebase
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                console.log('âœ… Firebase connectÃ©');
                
                // Ã‰couter les donnÃ©es
                const sensorRef = database.ref('sensors/tent_01');
                sensorRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        console.log('ğŸ“Š DonnÃ©es reÃ§ues:', data);
                        updateDashboard(data);
                        
                        // IncrÃ©menter l'usage
                        dataUsage += 0.01;
                        document.getElementById('dataUsage').textContent = dataUsage.toFixed(2);
                    }
                });
            } catch (error) {
                console.error('âŒ Erreur Firebase:', error);
                // Continuer en mode dÃ©mo
                startDemoMode();
            }
        }

        // Mettre Ã  jour le dashboard avec les vraies donnÃ©es
        function updateDashboard(data) {
            // IntÃ©rieur
            document.getElementById('tempInt').textContent = (data.temperature_interior ? data.temperature_interior.toFixed(1) : '25.3') + 'Â°C';
            document.getElementById('humInt').textContent = (data.humidity_interior || 62) + '%';
            document.getElementById('gas').textContent = (data.gas_ppm || 45) + ' ppm';
            document.getElementById('movementInt').textContent = data.movement || 'Aucun';
            
            // ExtÃ©rieur
            document.getElementById('tempExt').textContent = (data.temperature_exterior ? data.temperature_exterior.toFixed(1) : '22.8') + 'Â°C';
            document.getElementById('humExt').textContent = (data.humidity_exterior || 75) + '%';
            document.getElementById('wind').textContent = (data.wind_speed || 12) + ' km/h';
            
            // SystÃ¨me
            document.getElementById('signal').textContent = (data.signal_4g || 87) + '%';
            document.getElementById('battery').textContent = (data.battery || 94) + '%';
            document.getElementById('cpuTemp').textContent = (data.cpu_temp || 52) + 'Â°C';
            
            // Alerte gaz
            if (data.gas_ppm > 200) {
                document.getElementById('gasAlert').classList.add('show');
            } else {
                document.getElementById('gasAlert').classList.remove('show');
            }
            
            // Si mouvement dÃ©tectÃ©
            if (data.movement === 'DÃ©tectÃ©' || data.motion_detected) {
                document.getElementById('movementInt').textContent = 'DÃ©tectÃ©';
                document.getElementById('movementInt').style.color = '#F44336';
                setTimeout(() => {
                    document.getElementById('movementInt').textContent = 'Aucun';
                    document.getElementById('movementInt').style.color = '#4CAF50';
                }, 5000);
            }
        }

        // Mode dÃ©mo avec valeurs rÃ©alistes
        function startDemoMode() {
            console.log('ğŸ® Mode dÃ©mo activÃ©');
            
            setInterval(() => {
                // Valeurs rÃ©alistes qui varient lÃ©gÃ¨rement
                const baseTemp = 25;
                const baseHum = 65;
                const baseGas = 45;
                
                const data = {
                    temperature_interior: baseTemp + (Math.random() - 0.5) * 2,
                    humidity_interior: Math.round(baseHum + (Math.random() - 0.5) * 10),
                    gas_ppm: Math.round(baseGas + (Math.random() - 0.5) * 20),
                    temperature_exterior: baseTemp - 2 + (Math.random() - 0.5) * 2,
                    humidity_exterior: Math.round(baseHum + 10 + (Math.random() - 0.5) * 10),
                    wind_speed: Math.round(10 + Math.random() * 10),
                    signal_4g: Math.round(80 + Math.random() * 15),
                    battery: Math.round(90 + Math.random() * 8),
                    movement: Math.random() > 0.9 ? 'DÃ©tectÃ©' : 'Aucun'
                };
                
                updateDashboard(data);
                
                // Simuler l'usage de donnÃ©es
                dataUsage += 0.01;
                document.getElementById('dataUsage').textContent = dataUsage.toFixed(2);
            }, 3000);
        }

        // RafraÃ®chir les donnÃ©es
        function refreshData() {
            console.log('ğŸ”„ Actualisation...');
            
            // Animation du bouton
            event.target.style.transform = 'scale(0.95)';
            setTimeout(() => {
                event.target.style.transform = 'scale(1)';
            }, 200);
            
            // Si Firebase connectÃ©, forcer la lecture
            if (database) {
                database.ref('sensors/tent_01').once('value').then(snapshot => {
                    const data = snapshot.val();
                    if (data) updateDashboard(data);
                });
            }
        }

        // Capture photo
        function capturePhoto() {
            console.log('ğŸ“¸ Photo capturÃ©e');
            
            // Flash effect
            const video = document.querySelector('video');
            video.style.filter = 'brightness(2)';
            setTimeout(() => {
                video.style.filter = 'brightness(1)';
            }, 100);
            
            // Notification
            alert('Photo capturÃ©e avec succÃ¨s!');
        }

        // Au chargement
        window.onload = function() {
            console.log('ğŸ•ï¸ Smart Tent Dashboard v1.0');
            
            // VÃ©rifier Firebase
            if (firebaseConfig.apiKey !== "YOUR-API-KEY") {
                console.log('ğŸ”¥ Tentative de connexion Firebase...');
                initFirebase();
            } else {
                console.log('âš ï¸ Firebase non configurÃ© - Mode dÃ©mo');
                startDemoMode();
            }
        };
    </script>
</body>
</html>
