<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèïÔ∏è Smart Tent - Dashboard Firebase</title>
    <style>
        :root {
            --primary-green: #4CAF50;
            --dark-green: #2E7D32;
            --light-green: #81C784;
            --bg-green: #F1F8E9;
            --warning-orange: #FF9800;
            --danger-red: #F44336;
            --text-dark: #2C3E50;
            --card-shadow: 0 4px 12px rgba(46, 125, 50, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-green) 0%, #E8F5E8 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
        }

        .header h1 {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0.5rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background: #F44336;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .firebase-config {
            background: #FFF3E0;
            border: 2px dashed #FF9800;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .config-status {
            margin-top: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .config-status.success {
            background: #C8E6C9;
            color: #2E7D32;
        }

        .config-status.error {
            background: #FFCDD2;
            color: #C62828;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .sensor-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: transform 0.2s;
        }

        .sensor-section:hover {
            transform: translateY(-2px);
        }

        .sensor-section h2 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
            color: var(--dark-green);
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .sensor-card {
            background: var(--bg-green);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s;
        }

        .sensor-card.updating {
            animation: updatePulse 0.5s ease;
        }

        @keyframes updatePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .sensor-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .sensor-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 0.25rem;
            min-height: 2rem;
        }

        .sensor-label {
            font-size: 0.85rem;
            color: #666;
        }

        .alert-banner {
            background: linear-gradient(90deg, var(--danger-red), #FF6B6B);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            animation: alertSlide 0.5s ease;
        }

        .alert-banner.show {
            display: block;
        }

        @keyframes alertSlide {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .last-update {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: var(--primary-green);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .setup-instructions {
            background: #E3F2FD;
            border-left: 4px solid #2196F3;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .setup-instructions h3 {
            margin-bottom: 0.5rem;
        }

        .setup-instructions ol {
            margin-left: 1.5rem;
        }

        .setup-instructions code {
            background: #F5F5F5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sensor-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üèïÔ∏è Smart Tent - Dashboard Firebase</h1>
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="connectionStatus">Connexion en cours...</span>
                <span id="lastUpdate"></span>
            </div>
        </header>

        <div class="setup-instructions" id="setupInstructions">
            <h3>‚öôÔ∏è Configuration Firebase Requise</h3>
            <ol>
                <li>Cr√©ez un projet sur <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                <li>Activez Realtime Database en mode test</li>
                <li>Copiez votre configuration ci-dessous</li>
                <li>Modifiez le code source de cette page avec vos cl√©s</li>
            </ol>
            <p><strong>URL actuelle:</strong> <code id="currentUrl">Non configur√©</code></p>
        </div>

        <div class="firebase-config">
            <h3>üî• Configuration Firebase</h3>
            <p>Remplacez les valeurs dans le code source de cette page:</p>
            <div class="config-status" id="configStatus">
                ‚è≥ En attente de donn√©es Firebase...
            </div>
        </div>

        <div class="alert-banner" id="alertBanner">
            <strong>‚ö†Ô∏è ALERTE:</strong> <span id="alertMessage"></span>
        </div>

        <div class="dashboard-grid">
            <div class="sensor-section">
                <h2>üè† Conditions Int√©rieures</h2>
                <div class="sensor-grid">
                    <div class="sensor-card" id="tempIntCard">
                        <div class="sensor-icon">üå°Ô∏è</div>
                        <div class="sensor-value" id="tempInt">--¬∞C</div>
                        <div class="sensor-label">Temp√©rature</div>
                    </div>
                    <div class="sensor-card" id="humIntCard">
                        <div class="sensor-icon">üíß</div>
                        <div class="sensor-value" id="humInt">--%</div>
                        <div class="sensor-label">Humidit√©</div>
                    </div>
                    <div class="sensor-card" id="gasCard">
                        <div class="sensor-icon">üí®</div>
                        <div class="sensor-value" id="gas">-- ppm</div>
                        <div class="sensor-label">Gaz (MQ-5)</div>
                    </div>
                    <div class="sensor-card" id="movementCard">
                        <div class="sensor-icon">üëÅÔ∏è</div>
                        <div class="sensor-value" id="movement">--</div>
                        <div class="sensor-label">Mouvement</div>
                    </div>
                </div>
            </div>

            <div class="sensor-section">
                <h2>üåç Conditions Ext√©rieures</h2>
                <div class="sensor-grid">
                    <div class="sensor-card">
                        <div class="sensor-icon">üå°Ô∏è</div>
                        <div class="sensor-value" id="tempExt">--¬∞C</div>
                        <div class="sensor-label">Temp√©rature</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon">üíß</div>
                        <div class="sensor-value" id="humExt">--%</div>
                        <div class="sensor-label">Humidit√©</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon">üå¨Ô∏è</div>
                        <div class="sensor-value" id="wind">-- km/h</div>
                        <div class="sensor-label">Vent</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon">üîã</div>
                        <div class="sensor-value" id="battery">--%</div>
                        <div class="sensor-label">Batterie</div>
                    </div>
                </div>
            </div>

            <div class="sensor-section">
                <h2>üîß Syst√®me</h2>
                <div class="sensor-grid">
                    <div class="sensor-card">
                        <div class="sensor-icon">üì°</div>
                        <div class="sensor-value" id="signal">--%</div>
                        <div class="sensor-label">Signal 4G</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon">üìç</div>
                        <div class="sensor-value" id="location" style="font-size: 1rem;">--</div>
                        <div class="sensor-label">Localisation</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon">üÜî</div>
                        <div class="sensor-value" id="deviceId" style="font-size: 0.9rem;">--</div>
                        <div class="sensor-label">Device ID</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon">üìä</div>
                        <div class="sensor-value" id="dataCount">0</div>
                        <div class="sensor-label">Mises √† jour</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="last-update">
            <p id="updateInfo">En attente de connexion Firebase...</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // ‚ö†Ô∏è REMPLACEZ CES VALEURS PAR VOS PROPRES CL√âS FIREBASE
        const firebaseConfig = {
            apiKey: "YOUR-API-KEY",
            authDomain: "smart-tent-iot.firebaseapp.com",
            databaseURL: "https://smart-tent-iot-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "smart-tent-iot",
            storageBucket: "smart-tent-iot.appspot.com",
            messagingSenderId: "YOUR-SENDER-ID",
            appId: "YOUR-APP-ID"
        };

        // Variables globales
        let database;
        let isConnected = false;
        let updateCount = 0;
        let lastData = null;

        // Initialiser Firebase
        function initFirebase() {
            try {
                // Initialiser l'app Firebase
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                
                console.log('üî• Firebase initialis√©');
                document.getElementById('currentUrl').textContent = firebaseConfig.databaseURL;
                
                // √âcouter les changements
                listenToSensorData();
                listenToAlerts();
                
                // Tester la connexion
                testConnection();
                
            } catch (error) {
                console.error('‚ùå Erreur Firebase:', error);
                updateConfigStatus('error', 'Erreur: V√©rifiez votre configuration Firebase');
            }
        }

        // √âcouter les donn√©es des capteurs
        function listenToSensorData() {
            const sensorRef = database.ref('sensors/tent_01');
            
            sensorRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    console.log('üìä Donn√©es re√ßues:', data);
                    lastData = data;
                    updateCount++;
                    
                    // Mettre √† jour l'interface
                    updateSensorDisplay(data);
                    updateConnectionStatus(true);
                    updateConfigStatus('success', '‚úÖ Connect√© √† Firebase - Donn√©es en temps r√©el');
                    
                    // Masquer les instructions si tout fonctionne
                    if (updateCount > 2) {
                        document.getElementById('setupInstructions').style.display = 'none';
                    }
                } else {
                    console.log('‚ö†Ô∏è Aucune donn√©e disponible');
                    updateConfigStatus('error', 'Aucune donn√©e - Lancez le script Raspberry Pi');
                }
            }, (error) => {
                console.error('‚ùå Erreur lecture:', error);
                updateConnectionStatus(false);
                updateConfigStatus('error', `Erreur: ${error.message}`);
            });
        }

        // √âcouter les alertes
        function listenToAlerts() {
            const alertRef = database.ref('alerts/raspberry_kala_sghira/current');
            
            alertRef.on('value', (snapshot) => {
                const alert = snapshot.val();
                
                if (alert && alert.type) {
                    showAlert(alert.message || 'Alerte d√©tect√©e');
                } else {
                    hideAlert();
                }
            });
        }

        // Tester la connexion
        function testConnection() {
            const testRef = database.ref('.info/connected');
            
            testRef.on('value', (snapshot) => {
                isConnected = snapshot.val() === true;
                
                if (isConnected) {
                    console.log('‚úÖ Connect√© √† Firebase');
                } else {
                    console.log('‚ùå D√©connect√© de Firebase');
                    updateConnectionStatus(false);
                }
            });
        }

        // Mettre √† jour l'affichage des capteurs
        function updateSensorDisplay(data) {
            // Animation des cartes
            animateCard('tempIntCard');
            animateCard('humIntCard');
            animateCard('gasCard');
            animateCard('movementCard');
            
            // Valeurs int√©rieures
            document.getElementById('tempInt').textContent = data.temperature_interior + '¬∞C';
            document.getElementById('humInt').textContent = data.humidity_interior + '%';
            document.getElementById('gas').textContent = data.gas_ppm + ' ppm';
            document.getElementById('movement').textContent = data.movement || 'Aucun';
            
            // Valeurs ext√©rieures
            document.getElementById('tempExt').textContent = data.temperature_exterior + '¬∞C';
            document.getElementById('humExt').textContent = data.humidity_exterior + '%';
            document.getElementById('wind').textContent = data.wind_speed + ' km/h';
            document.getElementById('battery').textContent = data.battery + '%';
            
            // Syst√®me
            document.getElementById('signal').textContent = data.signal_4g + '%';
            document.getElementById('location').textContent = data.location || 'Kala Sghira';
            document.getElementById('deviceId').textContent = data.device_id || 'tent_01';
            document.getElementById('dataCount').textContent = updateCount;
            
            // Couleur de la batterie
            const batteryCard = document.querySelector('#battery').parentElement;
            if (data.battery < 20) {
                batteryCard.style.background = '#FFEBEE';
            } else if (data.battery < 50) {
                batteryCard.style.background = '#FFF3E0';
            }
            
            // Alerte gaz
            const gasCard = document.querySelector('#gas').parentElement;
            if (data.gas_ppm > 300) {
                gasCard.style.background = '#FFEBEE';
                showAlert(`ALERTE GAZ: ${data.gas_ppm} ppm - Ventilez imm√©diatement!`);
            } else if (data.gas_ppm > 200) {
                gasCard.style.background = '#FFF3E0';
            }
            
            // Timestamp
            if (data.timestamp) {
                const date = new Date(data.timestamp);
                document.getElementById('lastUpdate').textContent = 
                    ` - Derni√®re MAJ: ${date.toLocaleTimeString('fr-FR')}`;
            }
        }

        // Animer une carte
        function animateCard(cardId) {
            const card = document.getElementById(cardId);
            card.classList.add('updating');
            setTimeout(() => card.classList.remove('updating'), 500);
        }

        // Mettre √† jour le statut de connexion
        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('connectionStatus');
            
            if (connected) {
                statusDot.classList.remove('offline');
                statusText.textContent = 'Connect√© √† Firebase';
                document.getElementById('updateInfo').innerHTML = 
                    `<span class="loading"></span> √âcoute des donn√©es en temps r√©el...`;
            } else {
                statusDot.classList.add('offline');
                statusText.textContent = 'D√©connect√©';
                document.getElementById('updateInfo').textContent = 
                    'Connexion perdue - V√©rifiez votre configuration';
            }
        }

        // Mettre √† jour le statut de configuration
        function updateConfigStatus(type, message) {
            const statusDiv = document.getElementById('configStatus');
            statusDiv.className = `config-status ${type}`;
            statusDiv.textContent = message;
        }

        // Afficher une alerte
        function showAlert(message) {
            const alertBanner = document.getElementById('alertBanner');
            const alertMessage = document.getElementById('alertMessage');
            
            alertMessage.textContent = message;
            alertBanner.classList.add('show');
            
            // Jouer un son d'alerte (optionnel)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSt+zPLaizsIGmS48OScTgwOUKXh8LNgGQU7k9n1zn0s');
                audio.volume = 0.3;
                audio.play();
            } catch (e) {}
        }

        // Masquer l'alerte
        function hideAlert() {
            document.getElementById('alertBanner').classList.remove('show');
        }

        // Initialisation au chargement
        window.addEventListener('load', function() {
            console.log('üèïÔ∏è Smart Tent Firebase Dashboard');
            console.log('üìù Configuration requise:');
            console.log('1. Cr√©ez un projet Firebase');
            console.log('2. Activez Realtime Database');
            console.log('3. Remplacez firebaseConfig dans ce fichier');
            console.log('4. Lancez le script Python sur votre Raspberry Pi');
            
            // V√©rifier si la configuration est modifi√©e
            if (firebaseConfig.apiKey === "YOUR-API-KEY") {
                updateConfigStatus('error', '‚ö†Ô∏è Configurez d\'abord vos cl√©s Firebase dans le code!');
                document.getElementById('updateInfo').innerHTML = 
                    'üìù Modifiez le code source de cette page avec vos cl√©s Firebase';
            } else {
                // Initialiser Firebase
                initFirebase();
            }
        });

        // Afficher les donn√©es en console pour debug
        window.showLastData = function() {
            console.log('Derni√®res donn√©es re√ßues:', lastData);
        };
    </script>
</body>
</html>

        //
